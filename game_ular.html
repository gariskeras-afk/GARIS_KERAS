<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Ular Moderen üöÄ</title>
    <style>
        :root {
            --bg-color: #1a1a2e; /* Dark blue/purple */
            --snake-color: #00bcd4; /* Cyan */
            --food-color: #ff5722; /* Orange */
            --booster-color: #ffeb3b; /* Yellow */
            --ui-color: #ffffff;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--ui-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        #game-container {
            background-color: #162447;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 440px;
        }
        h1 {
            color: var(--snake-color);
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        #score-display {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: var(--booster-color);
            font-weight: 700;
        }
        #game-board {
            border: 5px solid var(--snake-color);
            background-color: #0d1222; 
            border-radius: 8px;
            display: block;
        }
        /* Style untuk Ular dan Makanan (di Canvas) */
        
        #message-display {
            margin-top: 15px;
            font-size: 1.1em;
            color: #ccc;
            min-height: 25px;
        }
        .button-group {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        #start-button {
            background-color: var(--snake-color); 
            color: #1a1a2e;
        }
        #start-button:hover {
            background-color: #00a4b7;
        }
        #telegram-share-button {
            background-color: #0088cc; 
            color: white;
            display: none; 
        }

        /* Mobile Swipe/Directional Controls */
        #mobile-controls {
            display: grid;
            grid-template-areas: ". up ." "left center right" ". down .";
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
            margin-top: 20px;
            /* Default: Sembunyikan di desktop */
            display: none; 
        }
        .dir-button {
            width: 60px;
            height: 60px;
            background-color: #3b4d66;
            color: white;
            font-size: 1.5em;
            border-radius: 8px;
        }
        @media (max-width: 600px) {
            #mobile-controls {
                display: grid; /* Tampilkan di layar kecil */
            }
            #up-button { grid-area: up; }
            #down-button { grid-area: down; }
            #left-button { grid-area: left; }
            #right-button { grid-area: right; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Game Ular Moderen üöÄ</h1>
        <div id="score-display">Skor: 0</div>
        <canvas id="game-board" width="400" height="400" touch-action="none"></canvas>
        <p id="message-display">Tekan MULAI atau panah untuk bermain.</p>
        
        <div class="button-group">
            <button id="start-button">Mulai Game</button>
            <button id="telegram-share-button">Bagikan Skor ke @GW_GK</button>
        </div>

        <div id="mobile-controls">
            <button id="up-button" class="dir-button" data-key="up">‚Üë</button>
            <button id="left-button" class="dir-button" data-key="left">‚Üê</button>
            <button id="right-button" class="dir-button" data-key="right">‚Üí</button>
            <button id="down-button" class="dir-button" data-key="down">‚Üì</button>
        </div>
    </div>

    <script>
        // --- Setup Game ---
        const board = document.getElementById('game-board');
        const ctx = board.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const startButton = document.getElementById('start-button');
        const telegramButton = document.getElementById('telegram-share-button');
        const messageDisplay = document.getElementById('message-display');
        
        // Konstanta Game
        const TILE_SIZE = 20; 
        const GRID_SIZE = board.width / TILE_SIZE;
        const BASE_SPEED = 100; // Kecepatan dasar
        const SLOW_SPEED = 150; // Kecepatan slow motion

        let snake, food, booster, dx, dy, score, gameInterval, isGameActive;
        let currentSpeed = BASE_SPEED;
        let isSlowMotionActive = false;
        let lastUpdateTime = 0;

        // Warna
        const snakeColor = getComputedStyle(document.documentElement).getPropertyValue('--snake-color');
        const foodColor = getComputedStyle(document.documentElement).getPropertyValue('--food-color');
        const boosterColor = getComputedStyle(document.documentElement).getPropertyValue('--booster-color');


        // --- Fungsi Utama Game ---
        function initializeGame() {
            snake = [{ x: 10 * TILE_SIZE, y: 10 * TILE_SIZE }]; 
            food = generateItem('food');
            booster = generateItem('booster');
            dx = TILE_SIZE; 
            dy = 0;
            score = 0;
            isGameActive = true;
            currentSpeed = BASE_SPEED;
            isSlowMotionActive = false;
            scoreDisplay.textContent = 'Skor: 0';
            messageDisplay.textContent = 'Gunakan tombol panah atau tombol sentuh.';
            startButton.style.display = 'none';
            telegramButton.style.display = 'none';

            if (gameInterval) clearInterval(gameInterval);
            // Menggunakan requestAnimationFrame untuk animasi yang lebih mulus
            gameInterval = requestAnimationFrame(gameLoop);
        }

        function gameLoop(timestamp) {
            if (!isGameActive) return;

            // Batasi update berdasarkan kecepatan game
            if (timestamp - lastUpdateTime < currentSpeed) {
                drawGame(); // Tetap gambar untuk animasi yang mulus
                requestAnimationFrame(gameLoop);
                return;
            }
            lastUpdateTime = timestamp;

            // 1. Pindah Ular
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            snake.unshift(head); 

            // 2. Cek Game Over
            if (checkCollision(head)) {
                gameOver();
                return;
            }

            // 3. Cek Makan Makanan
            if (head.x === food.x && head.y === food.y) {
                score += (isSlowMotionActive ? 2 : 1); // Skor ganda jika slow-motion
                scoreDisplay.textContent = `Skor: ${score}`;
                food = generateItem('food'); 
                // Setiap 5 makanan, buat booster baru
                if (score % 5 === 0) {
                    booster = generateItem('booster');
                }
            } else if (booster && head.x === booster.x && head.y === booster.y) {
                activateSlowMotion();
                booster = null; // Hapus booster
            } else {
                snake.pop(); // Hapus ekor (jika tidak makan item apa pun)
            }

            // 4. Gambar Ulang
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        function drawGame() {
            // Bersihkan Canvas
            ctx.fillStyle = '#0d1222'; 
            ctx.fillRect(0, 0, board.width, board.height);

            // Gambar Makanan (Food)
            if (food) {
                ctx.fillStyle = foodColor;
                // Gambar dengan sudut membulat
                drawRoundedRect(ctx, food.x, food.y, TILE_SIZE, TILE_SIZE, 3);
            }

            // Gambar Booster
            if (booster) {
                ctx.fillStyle = boosterColor;
                // Gambar dengan bentuk berlian (opsional)
                ctx.beginPath();
                ctx.moveTo(booster.x + TILE_SIZE/2, booster.y);
                ctx.lineTo(booster.x + TILE_SIZE, booster.y + TILE_SIZE/2);
                ctx.lineTo(booster.x + TILE_SIZE/2, booster.y + TILE_SIZE);
                ctx.lineTo(booster.x, booster.y + TILE_SIZE/2);
                ctx.closePath();
                ctx.fill();
            }

            // Gambar Ular (Snake)
            snake.forEach((segment, index) => {
                ctx.fillStyle = index === 0 ? snakeColor : '#00a4b7'; // Kepala lebih terang
                // Gambar dengan sudut membulat
                drawRoundedRect(ctx, segment.x, segment.y, TILE_SIZE, TILE_SIZE, 5); 
            });
            
            // Tampilkan status slow motion
            if (isSlowMotionActive) {
                messageDisplay.textContent = 'üöÄ SLOW MOTION AKTIF! (Skor Ganda!)';
            } else if (isGameActive) {
                 messageDisplay.textContent = 'Makan Booster untuk Slow Motion!';
            }
        }
        
        function drawRoundedRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }

        function generateItem(type) {
            let newItem;
            do {
                newItem = {
                    x: Math.floor(Math.random() * GRID_SIZE) * TILE_SIZE,
                    y: Math.floor(Math.random() * GRID_SIZE) * TILE_SIZE
                };
            } while (snake.some(segment => segment.x === newItem.x && segment.y === newItem.y) || (booster && newItem.x === booster.x && newItem.y === booster.y)); 
            return newItem;
        }

        function activateSlowMotion() {
            if (isSlowMotionActive) return;

            isSlowMotionActive = true;
            currentSpeed = SLOW_SPEED;
            
            // Nonaktifkan setelah 5 detik
            setTimeout(() => {
                isSlowMotionActive = false;
                currentSpeed = BASE_SPEED;
            }, 5000); 
        }

        function checkCollision(head) {
            const wallCollision = head.x < 0 || head.x >= board.width || head.y < 0 || head.y >= board.height;
            const selfCollision = snake.slice(1).some(segment => segment.x === head.x && segment.y === head.y);
            return wallCollision || selfCollision;
        }

        function gameOver() {
            isGameActive = false;
            cancelAnimationFrame(gameInterval); // Hentikan requestAnimationFrame
            messageDisplay.textContent = `GAME OVER! Skor Akhir: ${score}`;
            startButton.textContent = 'Main Lagi';
            startButton.style.display = 'block';
            telegramButton.style.display = 'block';
        }

        // --- Kontrol dan Event Listener ---
        function changeDirection(event) {
            if (!isGameActive) return;

            const keyPressed = event.keyCode || event.target.dataset.key;
            
            const goingUp = dy === -TILE_SIZE;
            const goingDown = dy === TILE_SIZE;
            const goingRight = dx === TILE_SIZE;
            const goingLeft = dx === -TILE_SIZE;

            switch(keyPressed) {
                case 37: // Kiri (ArrowLeft)
                case 'left':
                    if (!goingRight) { dx = -TILE_SIZE; dy = 0; }
                    break;
                case 38: // Atas (ArrowUp)
                case 'up':
                    if (!goingDown) { dx = 0; dy = -TILE_SIZE; }
                    break;
                case 39: // Kanan (ArrowRight)
                case 'right':
                    if (!goingLeft) { dx = TILE_SIZE; dy = 0; }
                    break;
                case 40: // Bawah (ArrowDown)
                case 'down':
                    if (!goingUp) { dx = 0; dy = TILE_SIZE; }
                    break;
            }
        }
        
        document.addEventListener('keydown', changeDirection);

        // Event listener untuk tombol mobile
        document.getElementById('up-button').addEventListener('click', changeDirection);
        document.getElementById('down-button').addEventListener('click', changeDirection);
        document.getElementById('left-button').addEventListener('click', changeDirection);
        document.getElementById('right-button').addEventListener('click', changeDirection);
        
        // Tombol Mulai
        startButton.addEventListener('click', initializeGame);

        // Tombol Telegram Share
        function shareTelegram() {
            const username = 'GW_GK';
            const shareMessage = `Aku berhasil mencapai *Skor ${score}* di Game Ular Moderen! Aku Master Slow Motion! Coba kalahkan skor aku, @GW_GK!`;
            const url = `https://t.me/${username}?text=${encodeURIComponent(shareMessage)}`;
            window.open(url, '_blank');
        }
        telegramButton.addEventListener('click', shareTelegram);

        // Inisialisasi tampilan awal
        drawGame();
    </script>
</body>
</html>
